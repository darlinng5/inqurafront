"use strict";(self.webpackChunksakai=self.webpackChunksakai||[]).push([[5117],{6768:(A,b,r)=>{r.d(b,{t:()=>x});var n=r(4650),f=r(7747),C=r(5384),Z=r(4006),g=r(2210);let x=(()=>{class h{constructor(t,u){this.commonService=t,this.eventService=u,this.ValueSelectedChange=new n.vpe,this.categorys=[],this.Filter=!1}ngOnInit(){this.data=this.DropDownDataSource,this.Filter=this.showFilter}changeValue(){this.ValueSelected=this.selectedData?.value,this.ValueSelectedChange.emit(this.ValueSelected)}selectedValue(){this.ValueSelected=this.selectedData?.value,this.ValueSelectedChange.emit(this.ValueSelected)}static#t=this.\u0275fac=function(u){return new(u||h)(n.Y36(f.M),n.Y36(C.P))};static#e=this.\u0275cmp=n.Xpm({type:h,selectors:[["app-drop-down"]],inputs:{ValueSelected:"ValueSelected",IsCreating:"IsCreating",showFilter:"showFilter",DropDownDataSource:"DropDownDataSource"},outputs:{ValueSelectedChange:"ValueSelectedChange"},decls:1,vars:3,consts:[["optionLabel","viewValue",3,"filter","options","ngModel","onClick","onChange","ngModelChange"]],template:function(u,a){1&u&&(n.TgZ(0,"p-dropdown",0),n.NdJ("onClick",function(){return a.selectedValue()})("onChange",function(){return a.changeValue()})("ngModelChange",function(l){return a.selectedData=l}),n.qZA()),2&u&&n.Q6J("filter",a.Filter)("options",a.data)("ngModel",a.selectedData)},dependencies:[Z.JJ,Z.On,g.Lt],encapsulation:2})}return h})()},3003:(A,b,r)=>{r.d(b,{c:()=>n});class n{}},5117:(A,b,r)=>{r.d(b,{L:()=>Y});var n=r(9197),f=r(5861),C=r(805),Z=r(3003),g=r(574),x=r(6166),h=r(4159),w=r.n(h),t=r(4650),u=r(7747),a=r(5384),d=r(6895),l=r(585),y=r(5593),S=r(4006),U=r(2453),N=r(6768),H=r(1383);function J(i,O){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"label",5),t._uU(2,"Usuarios"),t.qZA(),t.TgZ(3,"app-drop-down",17),t.NdJ("ValueSelectedChange",function(o){t.CHM(e);const c=t.oxw();return t.KtG(c.filterUser(o))}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("IsCreating",!1)("showFilter",!0)("DropDownDataSource",e.usersDropDown)}}function k(i,O){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"label",5),t._uU(2,"Sucursales"),t.qZA(),t.TgZ(3,"app-drop-down",18),t.NdJ("ValueSelectedChange",function(o){t.CHM(e);const c=t.oxw();return t.KtG(c.filterWareHouse(o))}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("IsCreating",!1)("showFilter",!0)("DropDownDataSource",e.wareHouseDropDown)}}function B(i,O){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"date"),t.ALo(3,"date"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.AsE(" Reporte del ",t.lcZ(2,2,e.StartDate)," al ",t.lcZ(3,4,e.FinalDate)," ")}}function V(i,O){if(1&i&&(t.TgZ(0,"tr",19)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA()()),2&i){const e=O.$implicit;t.xp6(2),t.Oqu(e.createdBy),t.xp6(2),t.Oqu(e.sarNumber),t.xp6(2),t.Oqu(e.costumerName),t.xp6(2),t.Oqu(e.date),t.xp6(2),t.hij("",e.payPercentaje,"%"),t.xp6(2),t.Oqu(e.discount),t.xp6(2),t.Oqu(e.payCredit),t.xp6(2),t.Oqu(e.payOthers),t.xp6(2),t.Oqu(e.payCash),t.xp6(2),t.Oqu(e.total)}}function Q(i,O){if(1&i&&(t.TgZ(0,"tr",19)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA()()),2&i){const e=O.$implicit;t.xp6(2),t.Oqu(e.payName),t.xp6(2),t.Oqu(e.payType),t.xp6(2),t.Oqu(e.total)}}function G(i,O){if(1&i){const e=t.EpF();t.TgZ(0,"div",20)(1,"button",21),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.printReport())}),t.qZA(),t.TgZ(2,"button",22),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.exportToExcel())}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("disabled",!e.InvoiceList||0===e.InvoiceList.length)}}let W=(()=>{class i{constructor(e,s,o,c){this.router=e,this.productService=s,this.messageService=o,this.eventService=c,this.loading=!1,this.InvoiceList=[],this.payReport=[],this.redirect=!1,this.AccessName="/pages/freportes"}ngOnInit(){const s=this.eventService.getPermisionsException().split(",").map(o=>o.trim());this.redirect=s.includes(this.AccessName),this.redirect&&this.router.navigateByUrl("/pages/unautorized"),this.userSelected="",this.wareHouseSelectd="",this.GetUsersByRole(),this.GetWareHouseByRole()}load(){this.loading=!0;var e=new Z.c;e.initialDate=this.StartDate,e.finalDate=this.FinalDate,this.getInvoiceReport(e)}getInvoiceReport(e){const s=this.eventService.getToken();e.userFilter=null==this.userSelected||"0"==this.userSelected?"ALL":this.userSelected,e.warehouseFilter=null==this.wareHouseSelectd||"0"==this.wareHouseSelectd?"ALL":this.wareHouseSelectd,this.productService.GetInvoiceReport(e,s).subscribe(o=>{if(console.log(o),o.data){this.InvoiceList=o.data.invoices,this.payReport=o.data.pays;var c=0,_=0,T=0,v=0,p=0;this.InvoiceList?.forEach(m=>{c+=m.payOthers,_+=m.payCash,T+=m.payCredit,v+=m.total,p+=m.discount}),this.totalOthers=c,this.totalCash=_,this.totalCredit=T,this.totalInvoice=v,this.totalDiscount=p}else this.messageService.add({severity:"error",summary:"Error",detail:o.message,life:3e3});this.loading=!1},o=>{this.messageService.add({severity:"error",summary:"Error",detail:o.message,life:3e3}),this.loading=!1})}exportToExcel(){const s=[["Usuario","Fecha","N\xfamero SAR","Nombre del cliente","Descuentos","Pago en efectivo","Pago con cr\xe9dito","Otros pagos","Impuesto total","Total"]];this.InvoiceList.forEach(p=>{s.push([p.createdBy,p.date,p.sarNumber,p.costumerName,p.discount,p.payCash,p.payCredit,p.payOthers,p.totalTax,p.total])});const o=g.P6.aoa_to_sheet(s),c=g.P6.book_new();g.P6.book_append_sheet(c,o,"Detalle de Facturas");const T=[["Nombre de Pago","Tipo de Pago","Total"]];this.payReport.forEach(p=>{T.push([p.payName,p.payType,p.total])});const v=g.P6.aoa_to_sheet(T);g.P6.book_append_sheet(c,v,"Detalle de Pagos"),g.NC(c,"Facturas.xlsx")}filterUser(e){this.userSelected=""==e||null==e?"-1":e}GetUsersByRole(){this.isLoading=!0,this.productService.GetUsersByRoleValues(this.eventService.getToken()).subscribe(e=>{e.data&&(this.usersDropDown=e.data,console.log(this.usersDropDown))})}filterWareHouse(e){this.wareHouseSelectd=e,console.log(this.wareHouseSelectd)}GetWareHouseByRole(){this.productService.GetWareHouseByRoleValues(this.eventService.getToken()).subscribe(e=>{e.data&&(this.wareHouseDropDown=e.data),this.isLoading=!1})}printReport(){var e=this;return(0,f.Z)(function*(){e.messageService.add({severity:"info",summary:"Info",detail:"El reporte se esta generando, favor espere",life:3e3}),e.isLoading=!0;const s=document.getElementById("print-section"),o=new x.ZP("p","pt","a4"),c={background:"white",scale:3},_=o.internal.pageSize.getWidth(),T=o.internal.pageSize.getHeight(),v={top:15,bottom:15,left:15,right:15},p=_-v.left-v.right,m=T-v.top-v.bottom;function z(D,E,P){E.addImage(D,"PNG",v.left,P,p,0,void 0,"FAST")}try{const D=yield w()(s,c),P=(D.toDataURL("image/png"),D.width),M=P/p;let F=D.height/M,q=v.top,L=1;for(;F>0;){const R=Math.min(m,F),I=document.createElement("canvas"),$=I.getContext("2d");I.width=P,I.height=R*M,$.drawImage(D,0,(L-1)*m*M,P,R*M,0,0,P,R*M),z(I.toDataURL("image/png"),o,q),F-=m,q=v.top,F>0&&(o.addPage(),L++)}const j=o.output("blob"),X=URL.createObjectURL(j);e.isLoading=!1,window.open(X,"_blank")}catch(D){console.error("Error generando PDF:",D),e.isLoading=!1}})()}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(n.F0),t.Y36(u.M),t.Y36(C.ez),t.Y36(a.P))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["ng-component"]],features:[t._Bn([C.ez])],decls:78,vars:15,consts:[[1,"grid"],[1,"col-12"],[1,"card"],[2,"display","flex","flex-wrap","wrap","justify-content","space-between"],[2,"flex","1","margin","5px"],["for","age1"],["inputId","icon",3,"ngModel","showIcon","ngModelChange"],["style","width: 100%;","style","flex: 1; margin: 5px;",4,"ngIf"],["style","flex: 1; margin: 5px;",4,"ngIf"],["label","Buscar","icon","pi pi-search","iconPos","right",1,"space",2,"width","100%",3,"loading","onClick"],["id","print-section"],[4,"ngIf"],["style","font-size: small;",4,"ngFor","ngForOf"],[1,"totals-row"],[2,"margin-top","20px"],["styleClass","mb-4"],["pTemplate","left"],[3,"IsCreating","showFilter","DropDownDataSource","ValueSelectedChange"],[2,"width","100%",3,"IsCreating","showFilter","DropDownDataSource","ValueSelectedChange"],[2,"font-size","small"],[1,"my-2"],["printSectionId","PrintFull","pButton","","pRipple","","label","imprimir","icon","pi pi-print",1,"p-button-help",3,"click"],["pButton","","pRipple","","label","Exportar a Excel","icon","pi pi-cloud-download",1,"p-button-success","mr-2",2,"margin-left","10px",3,"disabled","click"]],template:function(s,o){if(1&s&&(t._UZ(0,"p-toast"),t.TgZ(1,"div")(2,"div",0)(3,"div",1)(4,"div",2)(5,"h4"),t._uU(6,"Reporte de Facturas"),t.qZA(),t.TgZ(7,"div",3)(8,"div",4)(9,"label",5),t._uU(10,"Inicial"),t.qZA(),t.TgZ(11,"p-calendar",6),t.NdJ("ngModelChange",function(_){return o.StartDate=_}),t.qZA()(),t.TgZ(12,"div",4)(13,"label",5),t._uU(14,"Final"),t.qZA(),t.TgZ(15,"p-calendar",6),t.NdJ("ngModelChange",function(_){return o.FinalDate=_}),t.qZA()(),t.YNc(16,J,4,3,"div",7),t.YNc(17,k,4,3,"div",8),t.TgZ(18,"div",4)(19,"p-button",9),t.NdJ("onClick",function(){return o.load()}),t.qZA()()(),t._UZ(20,"p")(21,"p"),t.TgZ(22,"div",10),t.YNc(23,B,4,6,"div",11),t.TgZ(24,"table")(25,"tr")(26,"th"),t._uU(27,"Usuario"),t.qZA(),t.TgZ(28,"th"),t._uU(29,"Fac. N."),t.qZA(),t.TgZ(30,"th"),t._uU(31,"Cliente"),t.qZA(),t.TgZ(32,"th"),t._uU(33,"Fecha"),t.qZA(),t.TgZ(34,"th"),t._uU(35,"% Pagado"),t.qZA(),t.TgZ(36,"th"),t._uU(37,"Descuento"),t.qZA(),t.TgZ(38,"th"),t._uU(39,"Credito"),t.qZA(),t.TgZ(40,"th"),t._uU(41,"Otros"),t.qZA(),t.TgZ(42,"th"),t._uU(43,"Efectivo"),t.qZA(),t.TgZ(44,"th"),t._uU(45,"Total"),t.qZA()(),t.YNc(46,V,21,10,"tr",12),t.TgZ(47,"tr",13),t._UZ(48,"td"),t.TgZ(49,"td"),t._uU(50,"Totales"),t.qZA(),t._UZ(51,"td")(52,"td")(53,"td"),t.TgZ(54,"td"),t._uU(55),t.qZA(),t.TgZ(56,"td"),t._uU(57),t.qZA(),t.TgZ(58,"td"),t._uU(59),t.qZA(),t.TgZ(60,"td"),t._uU(61),t.qZA(),t.TgZ(62,"td"),t._uU(63),t.qZA()()(),t.TgZ(64,"h5"),t._uU(65,"Detalle de Tipos de Pago sin contar cr\xe9ditos"),t.qZA(),t.TgZ(66,"table")(67,"tr")(68,"th"),t._uU(69,"Nombre"),t.qZA(),t.TgZ(70,"th"),t._uU(71,"Tipo"),t.qZA(),t.TgZ(72,"th"),t._uU(73,"Total"),t.qZA()(),t.YNc(74,Q,7,3,"tr",12),t.qZA()()()()()(),t.TgZ(75,"div",14)(76,"p-toolbar",15),t.YNc(77,G,3,1,"ng-template",16),t.qZA()()),2&s){let c,_,T;t.xp6(11),t.Q6J("ngModel",o.StartDate)("showIcon",!0),t.xp6(4),t.Q6J("ngModel",o.FinalDate)("showIcon",!0),t.xp6(1),t.Q6J("ngIf",!o.isLoading&&(null!==(c=null==o.usersDropDown?null:o.usersDropDown.length)&&void 0!==c?c:0)>0),t.xp6(1),t.Q6J("ngIf",!o.isLoading&&(null!==(_=null==o.wareHouseDropDown?null:o.wareHouseDropDown.length)&&void 0!==_?_:0)>0),t.xp6(2),t.Q6J("loading",o.loading),t.xp6(4),t.Q6J("ngIf",(null!==(T=null==o.InvoiceList?null:o.InvoiceList.length)&&void 0!==T?T:0)>0),t.xp6(23),t.Q6J("ngForOf",o.InvoiceList),t.xp6(9),t.Oqu(o.totalDiscount),t.xp6(2),t.Oqu(o.totalCredit),t.xp6(2),t.Oqu(o.totalOthers),t.xp6(2),t.Oqu(o.totalCash),t.xp6(2),t.Oqu(o.totalInvoice),t.xp6(11),t.Q6J("ngForOf",o.payReport)}},dependencies:[d.sg,d.O5,l.f,y.Hq,y.zx,C.jx,S.JJ,S.On,U.FN,N.t,H.o,d.uU],styles:['[_ngcontent-%COMP%]:root {\n    --primary-color: #023b78;\n    --secondary-color: #1565bb;\n    --background-color: #f0f8ff;\n    --text-color: #333;\n    --border-color: #ccc;\n    --hover-color: #e9ecef;\n}\n\nbody[_ngcontent-%COMP%] {\n    font-family: Arial, sans-serif;\n    background-color: var(--background-color);\n    color: var(--text-color);\n    line-height: 1.6;\n    margin: 0;\n    padding: 20px;\n}\n\n#print-section[_ngcontent-%COMP%] {\n    background-color: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 20px;\n}\n\n.card[_ngcontent-%COMP%] {\n    margin-bottom: 20px;\n}\n\nh4[_ngcontent-%COMP%] {\n    color: var(--primary-color);\n    margin-top: 0;\n    margin-bottom: 20px;\n}\n\n.grid[_ngcontent-%COMP%] {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-bottom: 20px;\n}\n\n.col-12[_ngcontent-%COMP%] {\n    width: 100%;\n}\n\nlabel[_ngcontent-%COMP%] {\n    display: block;\n    margin-bottom: 5px;\n    color: var(--secondary-color);\n    font-weight: bold;\n}\n\np-calendar[_ngcontent-%COMP%], app-drop-down[_ngcontent-%COMP%] {\n    width: 100%;\n}\n\n.space[_ngcontent-%COMP%] {\n    margin-top: 10px;\n}\n\np-button[_ngcontent-%COMP%] {\n    width: 100%;\n}\n\np-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\n    background-color: var(--secondary-color);\n    border: none;\n    color: white;\n    padding: 10px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.3s;\n}\n\np-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover {\n    background-color: var(--primary-color);\n}\n\ntable[_ngcontent-%COMP%] {\n    width: 100%;\n    border-collapse: collapse;\n    margin-top: 20px;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\nth[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n    border: 1px solid var(--border-color);\n    padding: 12px;\n    text-align: left;\n}\n\nth[_ngcontent-%COMP%] {\n    background-color: var(--primary-color);\n    color: white;\n    font-weight: bold;\n}\n\n\ntr[_ngcontent-%COMP%]:nth-child(even) {\n    background-color: var(--background-color);\n}\n\n\ntr[_ngcontent-%COMP%]:hover {\n    background-color: var(--hover-color) !important;\n    transition: background-color 0.3s ease;\n}\n\n\n.totals-row[_ngcontent-%COMP%] {\n    font-weight: bold;\n    background-color: var(--background-color);\n}\n\n#PrintFull[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%] {\n    color: var(--secondary-color);\n    margin-top: 30px;\n    margin-bottom: 15px;\n}\n\n\ninput[_ngcontent-%COMP%], select[_ngcontent-%COMP%] {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n\ninput[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus {\n    outline: none;\n    border-color: var(--secondary-color);\n    box-shadow: 0 0 0 2px rgba(21, 101, 187, 0.1);\n}\n\n\ndiv[style*="display: flex"][_ngcontent-%COMP%] {\n    gap: 15px;\n}\n\ndiv[style*="display: flex"][_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n    flex: 1;\n    min-width: 200px;\n}\n\n@media (max-width: 768px) {\n    div[style*="display: flex"][_ngcontent-%COMP%] {\n        flex-direction: column;\n    }\n    \n    div[style*="display: flex"][_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n        width: 100%;\n    }\n}']})}return i})(),Y=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#e=this.\u0275mod=t.oAB({type:i});static#n=this.\u0275inj=t.cJS({imports:[n.Bz.forChild([{path:"",component:W}]),n.Bz]})}return i})()},1383:(A,b,r)=>{r.d(b,{V:()=>u,o:()=>t});var n=r(4650),f=r(6895),C=r(805);function Z(a,d){1&a&&n.GkF(0)}function g(a,d){if(1&a&&(n.TgZ(0,"div",3),n.YNc(1,Z,1,0,"ng-container",4),n.qZA()),2&a){const l=n.oxw();n.xp6(1),n.Q6J("ngTemplateOutlet",l.leftTemplate)}}function x(a,d){1&a&&n.GkF(0)}function h(a,d){if(1&a&&(n.TgZ(0,"div",5),n.YNc(1,x,1,0,"ng-container",4),n.qZA()),2&a){const l=n.oxw();n.xp6(1),n.Q6J("ngTemplateOutlet",l.rightTemplate)}}const w=["*"];let t=(()=>{class a{constructor(l){this.el=l}getBlockableElement(){return this.el.nativeElement.children[0]}ngAfterContentInit(){this.templates.forEach(l=>{switch(l.getType()){case"left":this.leftTemplate=l.template;break;case"right":this.rightTemplate=l.template}})}}return a.\u0275fac=function(l){return new(l||a)(n.Y36(n.SBq))},a.\u0275cmp=n.Xpm({type:a,selectors:[["p-toolbar"]],contentQueries:function(l,y,S){if(1&l&&n.Suo(S,C.jx,4),2&l){let U;n.iGM(U=n.CRH())&&(y.templates=U)}},hostAttrs:[1,"p-element"],inputs:{style:"style",styleClass:"styleClass"},ngContentSelectors:w,decls:4,vars:6,consts:[["role","toolbar",3,"ngClass","ngStyle"],["class","p-toolbar-group-left",4,"ngIf"],["class","p-toolbar-group-right",4,"ngIf"],[1,"p-toolbar-group-left"],[4,"ngTemplateOutlet"],[1,"p-toolbar-group-right"]],template:function(l,y){1&l&&(n.F$t(),n.TgZ(0,"div",0),n.Hsn(1),n.YNc(2,g,2,1,"div",1),n.YNc(3,h,2,1,"div",2),n.qZA()),2&l&&(n.Tol(y.styleClass),n.Q6J("ngClass","p-toolbar p-component")("ngStyle",y.style),n.xp6(2),n.Q6J("ngIf",y.leftTemplate),n.xp6(1),n.Q6J("ngIf",y.rightTemplate))},dependencies:[f.mk,f.O5,f.tP,f.PC],styles:[".p-toolbar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap}.p-toolbar-group-left,.p-toolbar-group-right{display:flex;align-items:center}\n"],encapsulation:2,changeDetection:0}),a})(),u=(()=>{class a{}return a.\u0275fac=function(l){return new(l||a)},a.\u0275mod=n.oAB({type:a}),a.\u0275inj=n.cJS({imports:[f.ez]}),a})()},5861:(A,b,r)=>{function n(C,Z,g,x,h,w,t){try{var u=C[w](t),a=u.value}catch(d){return void g(d)}u.done?Z(a):Promise.resolve(a).then(x,h)}function f(C){return function(){var Z=this,g=arguments;return new Promise(function(x,h){var w=C.apply(Z,g);function t(a){n(w,x,h,t,u,"next",a)}function u(a){n(w,x,h,t,u,"throw",a)}t(void 0)})}}r.d(b,{Z:()=>f})}}]);