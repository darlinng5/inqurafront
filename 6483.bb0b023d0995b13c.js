"use strict";(self.webpackChunksakai=self.webpackChunksakai||[]).push([[6483],{7116:(D,T,n)=>{n.d(T,{R:()=>h});var c=n(4650),v=n(3162);let h=(()=>{class s{constructor(){}static#t=this.\u0275fac=function(l){return new(l||s)};static#e=this.\u0275cmp=c.Xpm({type:s,selectors:[["app-progress-bar"]],decls:1,vars:0,consts:[["mode","indeterminate"]],template:function(l,u){1&l&&c._UZ(0,"mat-progress-bar",0)},dependencies:[v.pW],encapsulation:2})}return s})()},6483:(D,T,n)=>{n.r(T),n.d(T,{SalesDinamicReportModule:()=>K});var c=n(6895),v=n(9197),h=n(5861),s=n(6166),C=n(4159),p=n.n(C);class l{constructor(A,e,o,r,a){this.initialDate=A,this.finalDate=e,this.selectedUser=o,this.selectedBranch=r,this.userId=a}}var u=n(805),t=n(4650),f=n(7747),g=n(5384),d=n(4006),S=n(5593),N=n(7116),B=n(2496),L=n(5108),R=n(2453),J=n(302);function G(i,A){1&i&&(t.TgZ(0,"div"),t._UZ(1,"app-progress-bar"),t.qZA())}const M=function(i){return{"negative-profit":i}};function w(i,A){if(1&i&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"lempira"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.ALo(10,"lempira"),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.ALo(13,"lempira"),t.qZA(),t.TgZ(14,"td"),t._uU(15),t.ALo(16,"lempira"),t.qZA(),t.TgZ(17,"td",18),t._uU(18),t.ALo(19,"lempira"),t.qZA(),t.TgZ(20,"td"),t._uU(21),t.ALo(22,"lempira"),t.qZA(),t.TgZ(23,"td"),t._uU(24),t.ALo(25,"lempira"),t.qZA(),t.TgZ(26,"td"),t._uU(27),t.ALo(28,"lempira"),t.qZA(),t.TgZ(29,"td"),t._uU(30),t.ALo(31,"lempira"),t.qZA()()),2&i){const e=A.$implicit;t.xp6(2),t.Oqu(e.key),t.xp6(2),t.Oqu(e.count),t.xp6(2),t.Oqu(t.lcZ(7,12,e.totalCost)),t.xp6(3),t.Oqu(t.lcZ(10,14,e.totalTax)),t.xp6(3),t.Oqu(t.lcZ(13,16,e.totalBase)),t.xp6(3),t.Oqu(t.lcZ(16,18,e.totalPrice)),t.xp6(2),t.Q6J("ngClass",t.VKq(30,M,e.totalProfit<0)),t.xp6(1),t.hij(" ",t.lcZ(19,20,e.totalProfit)," "),t.xp6(3),t.Oqu(t.lcZ(22,22,e.totalEfectivo)),t.xp6(3),t.Oqu(t.lcZ(25,24,e.totalCredito)),t.xp6(3),t.Oqu(t.lcZ(28,26,e.totalTransferencia)),t.xp6(3),t.Oqu(t.lcZ(31,28,e.grandTotal))}}function z(i,A){if(1&i&&(t.TgZ(0,"table")(1,"thead")(2,"tr")(3,"th"),t._uU(4),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Transacciones"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Costo"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Impuesto"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Venta Base"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Venta Total"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Ganancia"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Efectivo"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"Cr\xe9dito"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"Transferencia"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Total Dinero"),t.qZA()()(),t.TgZ(25,"tbody"),t.YNc(26,w,32,32,"tr",17),t.qZA(),t.TgZ(27,"tfoot")(28,"tr")(29,"td")(30,"strong"),t._uU(31,"Total"),t.qZA()(),t.TgZ(32,"td"),t._uU(33),t.qZA(),t.TgZ(34,"td"),t._uU(35),t.ALo(36,"lempira"),t.qZA(),t.TgZ(37,"td"),t._uU(38),t.ALo(39,"lempira"),t.qZA(),t.TgZ(40,"td"),t._uU(41),t.ALo(42,"lempira"),t.qZA(),t.TgZ(43,"td"),t._uU(44),t.ALo(45,"lempira"),t.qZA(),t.TgZ(46,"td",18),t._uU(47),t.ALo(48,"lempira"),t.qZA(),t.TgZ(49,"td"),t._uU(50),t.ALo(51,"lempira"),t.qZA(),t.TgZ(52,"td"),t._uU(53),t.ALo(54,"lempira"),t.qZA(),t.TgZ(55,"td"),t._uU(56),t.ALo(57,"lempira"),t.qZA(),t.TgZ(58,"td"),t._uU(59),t.ALo(60,"lempira"),t.qZA()()()()),2&i){const e=t.oxw();t.xp6(4),t.Oqu(e.getFieldLabel(e.selectedField)),t.xp6(22),t.Q6J("ngForOf",e.report),t.xp6(7),t.Oqu(e.getTotalCount()),t.xp6(2),t.Oqu(t.lcZ(36,13,e.getTotalCost())),t.xp6(3),t.Oqu(t.lcZ(39,15,e.getTotalTax())),t.xp6(3),t.Oqu(t.lcZ(42,17,e.getTotalPrecioBase())),t.xp6(3),t.Oqu(t.lcZ(45,19,e.getTotalPrice())),t.xp6(2),t.Q6J("ngClass",t.VKq(31,M,e.getTotalProfit()<0)),t.xp6(1),t.hij(" ",t.lcZ(48,21,e.getTotalProfit())," "),t.xp6(3),t.Oqu(t.lcZ(51,23,e.getTotalEfectivo())),t.xp6(3),t.Oqu(t.lcZ(54,25,e.getTotalCredito())),t.xp6(3),t.Oqu(t.lcZ(57,27,e.getTotalTransferencia())),t.xp6(3),t.Oqu(t.lcZ(60,29,e.getGrandTotal()))}}function j(i,A){1&i&&(t.TgZ(0,"div"),t._UZ(1,"app-progress-bar"),t.qZA())}let H=(()=>{class i{constructor(e,o,r){this.productService=e,this.eventService=o,this.messageService=r,this.startDate=(new Date).toISOString().slice(0,10),this.endDate=(new Date).toISOString().slice(0,10),this.selectedField="customer",this.isLoading=!1,this.salesData=[],this.report=[]}ngOnInit(){this.messageService.add({severity:"info",summary:"Info",detail:"Inqura le recomienda dar clic en el icono de Expasion para una mejor visualizacion de datos",life:3e3})}GetReport(e){this.resultMessage="",this.isLoading=!0,this.productService.GetDynamicSalesReport(e).subscribe(o=>{o.data?(this.salesData=o.data||[],this.resultMessage=o.message,this.generateReport()):this.messageService.add({severity:"error",summary:"Error",detail:o.message,life:3e3}),this.isLoading=!1})}generateReport(){const e=this.groupBy(this.salesData,this.selectedField);this.report=Object.keys(e).map(o=>({key:o,count:e[o].length,totalCost:e[o].reduce((r,a)=>r+a.costPrice,0),totalPrice:e[o].reduce((r,a)=>r+a.price,0),totalBase:e[o].reduce((r,a)=>r+a.price-a.tax,0),totalProfit:e[o].reduce((r,a)=>r+a.price-a.tax-a.costPrice,0),totalTax:e[o].reduce((r,a)=>r+a.tax,0),totalEfectivo:e[o].reduce((r,a)=>r+a.efectivo,0),totalCredito:e[o].reduce((r,a)=>r+a.credito,0),totalTransferencia:e[o].reduce((r,a)=>r+a.transferencia,0),grandTotal:e[o].reduce((r,a)=>r+a.efectivo+a.transferencia+a.credito,0)}))}groupBy(e,o){return e.reduce((r,a)=>((r[a[o]]=r[a[o]]||[]).push(a),r),{})}getFieldLabel(e){return{customer:"Cliente",invoice:"N\xfamero de Factura",productName:"Nombre del Producto",comercialName:"Sucursal",taxName:"Impuesto"}[e]||e}getTotalCount(){return this.report.reduce((e,o)=>e+o.count,0)}getTotalCost(){return this.report.reduce((e,o)=>e+o.totalCost,0)}getTotalPrice(){return this.report.reduce((e,o)=>e+o.totalPrice,0)}getTotalTax(){return this.report.reduce((e,o)=>e+o.totalTax,0)}getTotalEfectivo(){return this.report.reduce((e,o)=>e+o.totalEfectivo,0)}getTotalCredito(){return this.report.reduce((e,o)=>e+o.totalCredito,0)}getTotalTransferencia(){return this.report.reduce((e,o)=>e+o.totalTransferencia,0)}getTotalPrecioBase(){return this.report.reduce((e,o)=>e+o.totalPrice-o.totalTax,0)}getGrandTotal(){return this.report.reduce((e,o)=>e+o.grandTotal,0)}getTotalProfit(){return this.report.reduce((e,o)=>e+o.totalProfit,0)}printReport(){var e=this;return(0,h.Z)(function*(){e.isLoading=!0;const o=document.getElementById("print-section"),r=new s.ZP("p","pt","a4"),a={background:"white",scale:3},U=r.internal.pageSize.getWidth(),V=r.internal.pageSize.getHeight(),Z={top:15,bottom:15,left:15,right:15},y=U-Z.left-Z.right,b=V-Z.top-Z.bottom;function X(m,E,x){E.addImage(m,"PNG",Z.left,x,y,0,void 0,"FAST")}try{const m=yield p()(o,a),x=(m.toDataURL("image/png"),m.width),_=x/y;let q=m.height/_,F=Z.top,I=1;for(;q>0;){const O=Math.min(b,q),P=document.createElement("canvas"),et=P.getContext("2d");P.width=x,P.height=O*_,et.drawImage(m,0,(I-1)*b*_,x,O*_,0,0,x,O*_),X(P.toDataURL("image/png"),r,F),q-=b,F=Z.top,q>0&&(r.addPage(),I++)}const k=r.output("blob"),tt=URL.createObjectURL(k);e.isLoading=!1,window.open(tt,"_blank")}catch(m){console.error("Error generando PDF:",m),e.isLoading=!1}})()}handleSearchCriteria(e){var o=new l(e.initialDate,e.finalDate,e.selectedUser,e.selectedBranch,this.eventService.getToken());this.GetReport(o)}static#t=this.\u0275fac=function(o){return new(o||i)(t.Y36(f.M),t.Y36(g.P),t.Y36(u.ez))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-dinamic-report"]],features:[t._Bn([u.ez])],decls:35,vars:5,consts:[[1,"invoice-report"],[4,"ngIf"],[3,"searchCriteria"],["id","print-section"],[1,"report-options"],[2,"text-align","center"],[3,"ngModel","ngModelChange","change"],["value","customer"],["value","userName"],["value","comercialName"],["value","invoice"],["value","productName"],["value","taxName"],["value","terms"],["value","isActualSale"],["align","left"],["pButton","","label","Imprimir","icon","pi pi-print",1,"p-button-outlined","mb-2",3,"click"],[4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(o,r){1&o&&(t.TgZ(0,"div",0),t.YNc(1,G,2,0,"div",1),t._UZ(2,"p-toast"),t.TgZ(3,"app-header-report-filter",2),t.NdJ("searchCriteria",function(U){return r.handleSearchCriteria(U)}),t.qZA(),t.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"h2"),t._uU(8,"Reporte de Ventas"),t.qZA()(),t.TgZ(9,"div",5)(10,"h5"),t._uU(11),t.qZA()(),t.TgZ(12,"label"),t._uU(13," Agrupar por: "),t.TgZ(14,"select",6),t.NdJ("ngModelChange",function(U){return r.selectedField=U})("change",function(){return r.generateReport()}),t.TgZ(15,"option",7),t._uU(16,"Cliente"),t.qZA(),t.TgZ(17,"option",8),t._uU(18,"Usuario"),t.qZA(),t.TgZ(19,"option",9),t._uU(20,"Sucursal"),t.qZA(),t.TgZ(21,"option",10),t._uU(22,"N\xfamero de Factura"),t.qZA(),t.TgZ(23,"option",11),t._uU(24,"Nombre del Producto"),t.qZA(),t.TgZ(25,"option",12),t._uU(26,"Tipo de Impuesto"),t.qZA(),t.TgZ(27,"option",13),t._uU(28,"Terminos de Pago"),t.qZA(),t.TgZ(29,"option",14),t._uU(30,"Cobro de facturas del Periodo / Cobro de facturas fuera del periodo"),t.qZA()()()(),t.YNc(31,z,61,33,"table",1),t.qZA()(),t.YNc(32,j,2,0,"div",1),t.TgZ(33,"p-divider",15)(34,"button",16),t.NdJ("click",function(){return r.printReport()}),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("ngIf",r.isLoading),t.xp6(10),t.hij(" ",r.resultMessage," "),t.xp6(3),t.Q6J("ngModel",r.selectedField),t.xp6(17),t.Q6J("ngIf",r.report.length>0),t.xp6(1),t.Q6J("ngIf",r.isLoading))},dependencies:[c.mk,c.sg,c.O5,d.YN,d.Kr,d.EJ,d.JJ,d.On,S.Hq,N.R,B.F,L.i,R.FN,J.E],styles:["[_nghost-%COMP%]{--primary-color: #023b78;--secondary-color: #1565bb;--background-color: #f0f8ff;--text-color: #333;--border-color: #ccc;--hover-color: #e9ecef;display:block;font-family:Arial,sans-serif;color:var(--text-color);background-color:var(--background-color);padding:20px;border-radius:8px;box-shadow:0 4px 6px #0000001a}h2[_ngcontent-%COMP%]{color:var(--primary-color);margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:15px;font-weight:700}select[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px;background-color:#fff;font-size:16px;margin-top:5px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px;background-color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid var(--border-color)}th[_ngcontent-%COMP%]{background-color:var(--secondary-color);color:#fff;font-weight:700}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--hover-color)}tfoot[_ngcontent-%COMP%]{font-weight:700}tfoot[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:2px solid var(--primary-color)}.negative-profit[_ngcontent-%COMP%]{color:red}"]})}return i})(),Y=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275mod=t.oAB({type:i});static#o=this.\u0275inj=t.cJS({imports:[v.Bz.forChild([{path:"",component:H}]),v.Bz]})}return i})();var Q=n(9585),W=n(4891);let K=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275mod=t.oAB({type:i});static#o=this.\u0275inj=t.cJS({imports:[c.ez,Y,d.u5,S.hJ,Q.xD,d.u5,W.E,L.x,R.EV]})}return i})()},5861:(D,T,n)=>{function c(h,s,C,p,l,u,t){try{var f=h[u](t),g=f.value}catch(d){return void C(d)}f.done?s(g):Promise.resolve(g).then(p,l)}function v(h){return function(){var s=this,C=arguments;return new Promise(function(p,l){var u=h.apply(s,C);function t(g){c(u,p,l,t,f,"next",g)}function f(g){c(u,p,l,t,f,"throw",g)}t(void 0)})}}n.d(T,{Z:()=>v})}}]);