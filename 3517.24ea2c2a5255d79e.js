"use strict";(self.webpackChunksakai=self.webpackChunksakai||[]).push([[3517],{3517:(_,Z,i)=>{i.r(Z),i.d(Z,{AccountReceivableModule:()=>q});var p=i(6895),R=i(9197),F=i(5861),C=i(805),h=i(574),L=i(6166),P=i(4159),w=i.n(P),t=i(4650),H=i(7747),M=i(5384),b=i(5593),x=i(5552),T=i(2453),I=i(6768);function z(n,j){if(1&n&&(t.TgZ(0,"tr",14)(1,"th",15),t._uU(2),t.qZA(),t.TgZ(3,"th",15),t._uU(4),t.qZA(),t.TgZ(5,"th",15),t._uU(6),t.ALo(7,"currency"),t.qZA(),t.TgZ(8,"th",15),t._uU(9),t.ALo(10,"date"),t.qZA(),t.TgZ(11,"th"),t._uU(12),t.ALo(13,"currency"),t.qZA(),t.TgZ(14,"th"),t._uU(15),t.qZA(),t.TgZ(16,"th"),t._uU(17),t.qZA(),t.TgZ(18,"th",15),t._uU(19),t.ALo(20,"currency"),t.qZA()()),2&n){const e=j.$implicit;t.xp6(2),t.Oqu(e.id),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(t.gM2(7,8,e.total,"L.","symbol","1.2-2")),t.xp6(3),t.Oqu(t.xi3(10,13,e.firstInvoice,"dd/MM/yyyy")),t.xp6(3),t.Oqu(t.gM2(13,16,e.maxAmountCredit,"L.","symbol","1.2-2")),t.xp6(3),t.Oqu(e.maxDayCredit),t.xp6(2),t.Oqu(e.dayCreditRest),t.xp6(2),t.Oqu(t.gM2(20,21,e.amoutCreditRest,"L.","symbol","1.2-2"))}}let B=(()=>{class n{constructor(e,o,a,r){this.router=e,this.productService=o,this.messageService=a,this.eventService=r,this.loading=!1,this.InvoiceList=[],this.payReport=[],this.redirect=!1,this.AccessName="/pages/receivable",this.accountFilter="Receivable",this.accountReceivableReport=[],this.AccountFilterList=[]}ngOnInit(){const o=this.eventService.getPermisionsException().split(",").map(a=>a.trim());this.redirect=o.includes(this.AccessName),this.redirect&&this.router.navigateByUrl("/pages/unautorized"),this.userSelected="",this.wareHouseSelectd="",this.AccountFilterList.push({value:"Receivable",viewValue:"Cuentas x Cobrar"}),this.AccountFilterList.push({value:"Payable",viewValue:"Cuentas x Pagar"}),this.GetUsersByRole(),this.GetWareHouseByRole()}load(){this.loading=!0,this.getAccountReceibableReport()}getAccountReceibableReport(){const e=this.eventService.getToken();this.productService.GetAccountReceivableReport(e,this.accountFilter).subscribe(o=>{console.log(o),o.data?(this.accountReceivableReport=o.data,console.log(this.accountReceivableReport)):this.messageService.add({severity:"error",summary:"Error",detail:o.message,life:3e3}),this.loading=!1},o=>{this.messageService.add({severity:"error",summary:"Error",detail:o.message,life:3e3}),this.loading=!1})}exportToExcel(){const o=[["Id","Cliente","Credito Actual","Factura Antigua","Maximo Credito Autorizado","Maximo Dias Autorizado","Dias Sobregirado","Monto Sobregirado"]];this.accountReceivableReport.forEach(s=>{o.push([s.id,s.name,s.total,s.firstInvoice,s.maxAmountCredit,s.maxDayCredit,s.dayCreditRest,s.amoutCreditRest])});const a=h.P6.aoa_to_sheet(o),r=h.P6.book_new();h.P6.book_append_sheet(r,a,"Detalle de CC");const v=[["Nombre de Pago","Tipo de Pago","Total"]];this.payReport.forEach(s=>{v.push([s.payName,s.payType,s.total])}),h.P6.aoa_to_sheet(v),h.NC(r,"DetalllesCC.xlsx")}filterUser(e){this.accountFilter=""==e||null==e?"":e}GetUsersByRole(){this.isLoading=!0,this.productService.GetUsersByRoleValues(this.eventService.getToken()).subscribe(e=>{e.data&&(this.usersDropDown=e.data,console.log(this.usersDropDown))})}filterWareHouse(e){this.wareHouseSelectd=e,console.log(this.wareHouseSelectd)}GetWareHouseByRole(){this.productService.GetWareHouseByRoleValues(this.eventService.getToken()).subscribe(e=>{e.data&&(this.wareHouseDropDown=e.data),this.isLoading=!1})}printReport(){var e=this;return(0,F.Z)(function*(){e.messageService.add({severity:"info",summary:"Info",detail:"El reporte se esta generando, favor espere",life:3e3}),e.isLoading=!0;const o=document.getElementById("print-section"),a=new L.ZP("p","pt","a4"),r={background:"white",scale:3},m=a.internal.pageSize.getWidth(),v=a.internal.pageSize.getHeight(),c={top:15,bottom:15,left:15,right:15},s=m-c.left-c.right,d=v-c.top-c.bottom;function Y(l,U,u){U.addImage(l,"PNG",c.left,u,s,0,void 0,"FAST")}try{const l=yield w()(o,r),u=(l.toDataURL("image/png"),l.width),g=u/s;let f=l.height/g,S=c.top,D=1;for(;f>0;){const y=Math.min(d,f),A=document.createElement("canvas"),$=A.getContext("2d");A.width=u,A.height=y*g,$.drawImage(l,0,(D-1)*d*g,u,y*g,0,0,u,y*g),Y(A.toDataURL("image/png"),a,S),f-=d,S=c.top,f>0&&(a.addPage(),D++)}const K=a.output("blob"),X=URL.createObjectURL(K);e.isLoading=!1,window.open(X,"_blank")}catch(l){console.error("Error generando PDF:",l),e.isLoading=!1}})()}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(R.F0),t.Y36(H.M),t.Y36(C.ez),t.Y36(M.P))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],features:[t._Bn([C.ez])],decls:36,vars:6,consts:[["id","print-section"],[1,"grid"],[1,"col-12"],[1,"card"],[2,"display","flex","flex-wrap","wrap","justify-content","space-between"],[2,"flex","1","margin","5px"],["htmlFor","age1"],[3,"IsCreating","showFilter","DropDownDataSource","ValueSelectedChange"],["label","Buscar","icon","pi pi-search","iconPos","right",1,"space",2,"width","100%",3,"loading","onClick"],["id","PrintFull"],[2,"background-color","#7288a2","color","white"],["style","font-size: small;",4,"ngFor","ngForOf"],["printSectionId","PrintFull","ngxPrint","","pButton","","pRipple","","label","imprimir","icon","pi pi-print",1,"p-button-help"],["pButton","","pRipple","","label","Exportar a Excel","icon","pi pi-cloud-download",1,"p-button-success","mr-2",2,"margin-left","10px",3,"disabled","click"],[2,"font-size","small"],["align","left"]],template:function(o,a){1&o&&(t._UZ(0,"p-toast"),t.TgZ(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"label",6),t._uU(8,"Tipo"),t.qZA(),t.TgZ(9,"app-drop-down",7),t.NdJ("ValueSelectedChange",function(m){return a.filterUser(m)}),t.qZA()(),t.TgZ(10,"div",5)(11,"p-button",8),t.NdJ("onClick",function(){return a.load()}),t.qZA()()(),t._UZ(12,"p")(13,"p"),t.TgZ(14,"div",9)(15,"table")(16,"tr",10)(17,"th"),t._uU(18,"Id"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"Cliente"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"Credito Actual"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Factura Antigua"),t.qZA(),t.TgZ(25,"th"),t._uU(26,"Maximo Credito Autorizado"),t.qZA(),t.TgZ(27,"th"),t._uU(28,"Maximo Dias Autorizado"),t.qZA(),t.TgZ(29,"th"),t._uU(30,"Dias Sobregirado"),t.qZA(),t.TgZ(31,"th"),t._uU(32,"Monto Sobregirado"),t.qZA()(),t.YNc(33,z,21,26,"tr",11),t.qZA()()()()()(),t._UZ(34,"button",12),t.TgZ(35,"button",13),t.NdJ("click",function(){return a.exportToExcel()}),t.qZA()),2&o&&(t.xp6(9),t.Q6J("IsCreating",!1)("showFilter",!1)("DropDownDataSource",a.AccountFilterList),t.xp6(2),t.Q6J("loading",a.loading),t.xp6(22),t.Q6J("ngForOf",a.accountReceivableReport),t.xp6(2),t.Q6J("disabled",!a.accountReceivableReport||0===a.accountReceivableReport.length))},dependencies:[p.sg,b.Hq,b.zx,x.IH,T.FN,I.t,p.H9,p.uU],styles:["table[_ngcontent-%COMP%] {\n    border-collapse: collapse;\n    width: 100%;\n  }\n  \n  tr[_ngcontent-%COMP%] {\n    border-bottom: 1px solid #ddd;\n  }\n  .space[_ngcontent-%COMP%] {\nwidth: 4px;\nheight: auto;\nmargin-left: 20px;\n}"]})}return n})(),O=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[R.Bz.forChild([{path:"",component:B}]),R.Bz]})}return n})();var E=i(4006),N=i(5117),J=i(585),G=i(2210),V=i(4891),W=i(1383);let q=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[p.ez,O,E.u5,b.hJ,p.ez,N.L,J._8,x.K8,T.EV,G.kW,V.E,W.V]})}return n})()}}]);