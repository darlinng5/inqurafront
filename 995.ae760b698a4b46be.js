"use strict";(self.webpackChunksakai=self.webpackChunksakai||[]).push([[995],{7116:(y,Z,n)=>{n.d(Z,{R:()=>h});var r=n(4650),d=n(3162);let h=(()=>{class g{constructor(){}static#t=this.\u0275fac=function(u){return new(u||g)};static#e=this.\u0275cmp=r.Xpm({type:g,selectors:[["app-progress-bar"]],decls:1,vars:0,consts:[["mode","indeterminate"]],template:function(u,f){1&u&&r._UZ(0,"mat-progress-bar",0)},dependencies:[d.pW],encapsulation:2})}return g})()},995:(y,Z,n)=>{n.r(Z),n.d(Z,{SalesDinamicReportModule:()=>V});var r=n(6895),d=n(9197),h=n(5861),g=n(6166),A=n(4159),m=n.n(A),u=n(6624),f=n(805),t=n(4650),T=n(7747),l=n(5384),p=n(4006),c=n(5593),v=n(7116),M=n(2496),b=n(2453),R=n(1383),J=n(302);function w(s,O){1&s&&(t.TgZ(0,"div"),t._UZ(1,"app-progress-bar"),t.qZA())}const E=function(s){return{"negative-profit":s}};function Q(s,O){if(1&s&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"lempira"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.ALo(10,"lempira"),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.ALo(13,"lempira"),t.qZA(),t.TgZ(14,"td"),t._uU(15),t.ALo(16,"lempira"),t.qZA(),t.TgZ(17,"td",23),t._uU(18),t.ALo(19,"lempira"),t.qZA(),t.TgZ(20,"td"),t._uU(21),t.ALo(22,"lempira"),t.qZA(),t.TgZ(23,"td"),t._uU(24),t.ALo(25,"lempira"),t.qZA(),t.TgZ(26,"td"),t._uU(27),t.ALo(28,"lempira"),t.qZA(),t.TgZ(29,"td"),t._uU(30),t.ALo(31,"lempira"),t.qZA()()),2&s){const e=O.$implicit;t.xp6(2),t.Oqu(e.key),t.xp6(2),t.Oqu(e.count),t.xp6(2),t.Oqu(t.lcZ(7,12,e.totalCost)),t.xp6(3),t.Oqu(t.lcZ(10,14,e.totalTax)),t.xp6(3),t.Oqu(t.lcZ(13,16,e.totalBase)),t.xp6(3),t.Oqu(t.lcZ(16,18,e.totalPrice)),t.xp6(2),t.Q6J("ngClass",t.VKq(30,E,e.totalProfit<0)),t.xp6(1),t.hij(" ",t.lcZ(19,20,e.totalProfit)," "),t.xp6(3),t.Oqu(t.lcZ(22,22,e.totalEfectivo)),t.xp6(3),t.Oqu(t.lcZ(25,24,e.totalCredito)),t.xp6(3),t.Oqu(t.lcZ(28,26,e.totalTransferencia)),t.xp6(3),t.Oqu(t.lcZ(31,28,e.grandTotal))}}function G(s,O){if(1&s&&(t.TgZ(0,"table")(1,"thead")(2,"tr")(3,"th"),t._uU(4),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Transacciones"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Costo"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Impuesto"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Venta Base"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Venta Total"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Ganancia"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Efectivo"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"Cr\xe9dito"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"Transferencia"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Total Dinero"),t.qZA()()(),t.TgZ(25,"tbody"),t.YNc(26,Q,32,32,"tr",22),t.qZA(),t.TgZ(27,"tfoot")(28,"tr")(29,"td")(30,"strong"),t._uU(31,"Total"),t.qZA()(),t.TgZ(32,"td"),t._uU(33),t.qZA(),t.TgZ(34,"td"),t._uU(35),t.ALo(36,"lempira"),t.qZA(),t.TgZ(37,"td"),t._uU(38),t.ALo(39,"lempira"),t.qZA(),t.TgZ(40,"td"),t._uU(41),t.ALo(42,"lempira"),t.qZA(),t.TgZ(43,"td"),t._uU(44),t.ALo(45,"lempira"),t.qZA(),t.TgZ(46,"td",23),t._uU(47),t.ALo(48,"lempira"),t.qZA(),t.TgZ(49,"td"),t._uU(50),t.ALo(51,"lempira"),t.qZA(),t.TgZ(52,"td"),t._uU(53),t.ALo(54,"lempira"),t.qZA(),t.TgZ(55,"td"),t._uU(56),t.ALo(57,"lempira"),t.qZA(),t.TgZ(58,"td"),t._uU(59),t.ALo(60,"lempira"),t.qZA()()()()),2&s){const e=t.oxw();t.xp6(4),t.Oqu(e.getFieldLabel(e.selectedField)),t.xp6(22),t.Q6J("ngForOf",e.report),t.xp6(7),t.Oqu(e.getTotalCount()),t.xp6(2),t.Oqu(t.lcZ(36,13,e.getTotalCost())),t.xp6(3),t.Oqu(t.lcZ(39,15,e.getTotalTax())),t.xp6(3),t.Oqu(t.lcZ(42,17,e.getTotalPrecioBase())),t.xp6(3),t.Oqu(t.lcZ(45,19,e.getTotalPrice())),t.xp6(2),t.Q6J("ngClass",t.VKq(31,E,e.getTotalProfit()<0)),t.xp6(1),t.hij(" ",t.lcZ(48,21,e.getTotalProfit())," "),t.xp6(3),t.Oqu(t.lcZ(51,23,e.getTotalEfectivo())),t.xp6(3),t.Oqu(t.lcZ(54,25,e.getTotalCredito())),t.xp6(3),t.Oqu(t.lcZ(57,27,e.getTotalTransferencia())),t.xp6(3),t.Oqu(t.lcZ(60,29,e.getGrandTotal()))}}function Y(s,O){1&s&&(t.TgZ(0,"div"),t._UZ(1,"app-progress-bar"),t.qZA())}let j=(()=>{class s{constructor(e,o,a){this.productService=e,this.eventService=o,this.messageService=a,this.startDate=(new Date).toISOString().slice(0,10),this.endDate=(new Date).toISOString().slice(0,10),this.selectedField="customer",this.isLoading=!1,this.salesData=[],this.report=[]}ngOnInit(){this.messageService.add({severity:"info",summary:"Info",detail:"Inqura le recomienda dar clic en el icono de Expasion para una mejor visualizacion de datos",life:3e3})}GetReport(e){this.resultMessage="",this.isLoading=!0,this.productService.GetDynamicSalesReport(e).subscribe(o=>{o.data?(this.salesData=o.data||[],this.resultMessage=o.message,this.generateReport()):this.messageService.add({severity:"error",summary:"Error",detail:o.message,life:3e3}),this.isLoading=!1})}generateReport(){const e=this.groupBy(this.salesData,this.selectedField);this.report=Object.keys(e).map(o=>({key:o,count:e[o].length,totalCost:e[o].reduce((a,i)=>a+i.costPrice,0),totalPrice:e[o].reduce((a,i)=>a+i.price,0),totalBase:e[o].reduce((a,i)=>a+i.price-i.tax,0),totalProfit:e[o].reduce((a,i)=>a+i.price-i.tax-i.costPrice,0),totalTax:e[o].reduce((a,i)=>a+i.tax,0),totalEfectivo:e[o].reduce((a,i)=>a+i.efectivo,0),totalCredito:e[o].reduce((a,i)=>a+i.credito,0),totalTransferencia:e[o].reduce((a,i)=>a+i.transferencia,0),grandTotal:e[o].reduce((a,i)=>a+i.efectivo+i.transferencia+i.credito,0)}))}groupBy(e,o){return e.reduce((a,i)=>((a[i[o]]=a[i[o]]||[]).push(i),a),{})}getFieldLabel(e){return{customer:"Cliente",invoice:"N\xfamero de Factura",productName:"Nombre del Producto",comercialName:"Sucursal",taxName:"Impuesto"}[e]||e}getTotalCount(){return this.report.reduce((e,o)=>e+o.count,0)}getTotalCost(){return this.report.reduce((e,o)=>e+o.totalCost,0)}getTotalPrice(){return this.report.reduce((e,o)=>e+o.totalPrice,0)}getTotalTax(){return this.report.reduce((e,o)=>e+o.totalTax,0)}getTotalEfectivo(){return this.report.reduce((e,o)=>e+o.totalEfectivo,0)}getTotalCredito(){return this.report.reduce((e,o)=>e+o.totalCredito,0)}getTotalTransferencia(){return this.report.reduce((e,o)=>e+o.totalTransferencia,0)}getTotalPrecioBase(){return this.report.reduce((e,o)=>e+o.totalPrice-o.totalTax,0)}getGrandTotal(){return this.report.reduce((e,o)=>e+o.grandTotal,0)}getTotalProfit(){return this.report.reduce((e,o)=>e+o.totalProfit,0)}printReport(){var e=this;return(0,h.Z)(function*(){e.isLoading=!0;const o=document.getElementById("print-section"),a=new g.ZP("p","pt","a4"),i={background:"white",scale:3},U=a.internal.pageSize.getWidth(),X=a.internal.pageSize.getHeight(),x={top:15,bottom:15,left:15,right:15},F=U-x.left-x.right,S=X-x.top-x.bottom;function $(_,I,C){I.addImage(_,"PNG",x.left,C,F,0,void 0,"FAST")}try{const _=yield m()(o,i),C=(_.toDataURL("image/png"),_.width),P=C/F;let q=_.height/P,B=x.top,N=1;for(;q>0;){const L=Math.min(S,q),D=document.createElement("canvas"),ot=D.getContext("2d");D.width=C,D.height=L*P,ot.drawImage(_,0,(N-1)*S*P,C,L*P,0,0,C,L*P),$(D.toDataURL("image/png"),a,B),q-=S,B=x.top,q>0&&(a.addPage(),N++)}const tt=a.output("blob"),et=URL.createObjectURL(tt);e.isLoading=!1,window.open(et,"_blank")}catch(_){console.error("Error generando PDF:",_),e.isLoading=!1}})()}handleSearchCriteria(e){var o=new u.C(e.initialDate,e.finalDate,e.selectedUser,e.selectedBranch,this.eventService.getToken());this.GetReport(o)}static#t=this.\u0275fac=function(o){return new(o||s)(t.Y36(T.M),t.Y36(l.P),t.Y36(f.ez))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-dinamic-report"]],features:[t._Bn([f.ez])],decls:40,vars:6,consts:[[1,"invoice-report"],[4,"ngIf"],[1,"grid"],[1,"col-12"],[1,"card"],[3,"showDate","searchCriteria"],["id","print-section"],[1,"report-options"],[2,"text-align","center"],[3,"ngModel","ngModelChange","change"],["value","customer"],["value","userName"],["value","comercialName"],["value","invoice"],["value","productName"],["value","taxName"],["value","terms"],["value","isActualSale"],[2,"margin-top","20px"],["styleClass","mb-4"],[1,"my-2"],["pButton","","pRipple","","label","imprimir","icon","pi pi-print",1,"p-button-help",3,"click"],[4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(o,a){1&o&&(t.TgZ(0,"div",0),t.YNc(1,w,2,0,"div",1),t._UZ(2,"p-toast"),t.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"app-header-report-filter",5),t.NdJ("searchCriteria",function(U){return a.handleSearchCriteria(U)}),t.qZA(),t.TgZ(7,"div",6)(8,"div",7)(9,"div",8)(10,"h2"),t._uU(11,"Reporte de Ventas"),t.qZA()(),t.TgZ(12,"div",8)(13,"h5"),t._uU(14),t.qZA()(),t.TgZ(15,"label"),t._uU(16," Agrupar por: "),t.TgZ(17,"select",9),t.NdJ("ngModelChange",function(U){return a.selectedField=U})("change",function(){return a.generateReport()}),t.TgZ(18,"option",10),t._uU(19,"Cliente"),t.qZA(),t.TgZ(20,"option",11),t._uU(21,"Usuario"),t.qZA(),t.TgZ(22,"option",12),t._uU(23,"Sucursal"),t.qZA(),t.TgZ(24,"option",13),t._uU(25,"N\xfamero de Factura"),t.qZA(),t.TgZ(26,"option",14),t._uU(27,"Nombre del Producto"),t.qZA(),t.TgZ(28,"option",15),t._uU(29,"Tipo de Impuesto"),t.qZA(),t.TgZ(30,"option",16),t._uU(31,"Terminos de Pago"),t.qZA(),t.TgZ(32,"option",17),t._uU(33,"Cobro de facturas del Periodo / Cobro de facturas fuera del periodo"),t.qZA()()()(),t.YNc(34,G,61,33,"table",1),t.qZA()(),t.YNc(35,Y,2,0,"div",1),t.qZA()()(),t.TgZ(36,"div",18)(37,"p-toolbar",19)(38,"div",20)(39,"button",21),t.NdJ("click",function(){return a.printReport()}),t.qZA()()()()),2&o&&(t.xp6(1),t.Q6J("ngIf",a.isLoading),t.xp6(5),t.Q6J("showDate",!0),t.xp6(8),t.hij(" ",a.resultMessage," "),t.xp6(3),t.Q6J("ngModel",a.selectedField),t.xp6(17),t.Q6J("ngIf",a.report.length>0),t.xp6(1),t.Q6J("ngIf",a.isLoading))},dependencies:[r.mk,r.sg,r.O5,p.YN,p.Kr,p.EJ,p.JJ,p.On,c.Hq,v.R,M.F,b.FN,R.o,J.E],styles:["[_nghost-%COMP%]{--primary-color: #023b78;--secondary-color: #1565bb;--background-color: #f0f8ff;--text-color: #333;--border-color: #ccc;--hover-color: #e9ecef;display:block;font-family:Arial,sans-serif;color:var(--text-color);padding:20px;border-radius:8px;box-shadow:0 4px 6px #0000001a}h2[_ngcontent-%COMP%]{color:var(--primary-color);margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:15px;font-weight:700}select[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px;background-color:#fff;font-size:16px;margin-top:5px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px;background-color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid var(--border-color)}th[_ngcontent-%COMP%]{background-color:var(--secondary-color);color:#fff;font-weight:700}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--hover-color)}tfoot[_ngcontent-%COMP%]{font-weight:700}tfoot[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:2px solid var(--primary-color)}.negative-profit[_ngcontent-%COMP%]{color:red}"]})}return s})(),z=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#o=this.\u0275inj=t.cJS({imports:[d.Bz.forChild([{path:"",component:j}]),d.Bz]})}return s})();var H=n(9585),W=n(4891),K=n(5108);let V=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#o=this.\u0275inj=t.cJS({imports:[r.ez,z,p.u5,c.hJ,H.xD,p.u5,W.E,K.x,b.EV,R.V]})}return s})()},1383:(y,Z,n)=>{n.d(Z,{V:()=>T,o:()=>t});var r=n(4650),d=n(6895),h=n(805);function g(l,p){1&l&&r.GkF(0)}function A(l,p){if(1&l&&(r.TgZ(0,"div",3),r.YNc(1,g,1,0,"ng-container",4),r.qZA()),2&l){const c=r.oxw();r.xp6(1),r.Q6J("ngTemplateOutlet",c.leftTemplate)}}function m(l,p){1&l&&r.GkF(0)}function u(l,p){if(1&l&&(r.TgZ(0,"div",5),r.YNc(1,m,1,0,"ng-container",4),r.qZA()),2&l){const c=r.oxw();r.xp6(1),r.Q6J("ngTemplateOutlet",c.rightTemplate)}}const f=["*"];let t=(()=>{class l{constructor(c){this.el=c}getBlockableElement(){return this.el.nativeElement.children[0]}ngAfterContentInit(){this.templates.forEach(c=>{switch(c.getType()){case"left":this.leftTemplate=c.template;break;case"right":this.rightTemplate=c.template}})}}return l.\u0275fac=function(c){return new(c||l)(r.Y36(r.SBq))},l.\u0275cmp=r.Xpm({type:l,selectors:[["p-toolbar"]],contentQueries:function(c,v,M){if(1&c&&r.Suo(M,h.jx,4),2&c){let b;r.iGM(b=r.CRH())&&(v.templates=b)}},hostAttrs:[1,"p-element"],inputs:{style:"style",styleClass:"styleClass"},ngContentSelectors:f,decls:4,vars:6,consts:[["role","toolbar",3,"ngClass","ngStyle"],["class","p-toolbar-group-left",4,"ngIf"],["class","p-toolbar-group-right",4,"ngIf"],[1,"p-toolbar-group-left"],[4,"ngTemplateOutlet"],[1,"p-toolbar-group-right"]],template:function(c,v){1&c&&(r.F$t(),r.TgZ(0,"div",0),r.Hsn(1),r.YNc(2,A,2,1,"div",1),r.YNc(3,u,2,1,"div",2),r.qZA()),2&c&&(r.Tol(v.styleClass),r.Q6J("ngClass","p-toolbar p-component")("ngStyle",v.style),r.xp6(2),r.Q6J("ngIf",v.leftTemplate),r.xp6(1),r.Q6J("ngIf",v.rightTemplate))},dependencies:[d.mk,d.O5,d.tP,d.PC],styles:[".p-toolbar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap}.p-toolbar-group-left,.p-toolbar-group-right{display:flex;align-items:center}\n"],encapsulation:2,changeDetection:0}),l})(),T=(()=>{class l{}return l.\u0275fac=function(c){return new(c||l)},l.\u0275mod=r.oAB({type:l}),l.\u0275inj=r.cJS({imports:[d.ez]}),l})()},5861:(y,Z,n)=>{function r(h,g,A,m,u,f,t){try{var T=h[f](t),l=T.value}catch(p){return void A(p)}T.done?g(l):Promise.resolve(l).then(m,u)}function d(h){return function(){var g=this,A=arguments;return new Promise(function(m,u){var f=h.apply(g,A);function t(l){r(f,m,u,t,T,"next",l)}function T(l){r(f,m,u,t,T,"throw",l)}t(void 0)})}}n.d(Z,{Z:()=>d})}}]);