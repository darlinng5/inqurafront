"use strict";(self.webpackChunksakai=self.webpackChunksakai||[]).push([[5994],{5994:(M,T,i)=>{i.r(T),i.d(T,{FacturaReporteModule:()=>P});var g=i(9808),f=i(7449),_=i(9783),F=i(3003),p=i(574),e=i(5e3),y=i(7747),x=i(5384),A=i(5652),v=i(845),Z=i(3075),U=i(6186),C=i(7773),D=i(6768);function q(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",5)(1,"label",6),e._uU(2,"Usuarios"),e.qZA(),e.TgZ(3,"app-drop-down",18),e.NdJ("ValueSelectedChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.filterUser(n))}),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(3),e.Q6J("IsCreating",!1)("showFilter",!0)("DropDownDataSource",t.usersDropDown)}}function w(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",5)(1,"label",6),e._uU(2,"Sucursales"),e.qZA(),e.TgZ(3,"app-drop-down",19),e.NdJ("ValueSelectedChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.filterWareHouse(n))}),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(3),e.Q6J("IsCreating",!1)("showFilter",!0)("DropDownDataSource",t.wareHouseDropDown)}}function R(a,l){if(1&a&&(e.TgZ(0,"div"),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.AsE(" Reporte del ",e.lcZ(2,2,t.StartDate)," al ",e.lcZ(3,4,t.FinalDate)," ")}}function S(a,l){if(1&a&&(e.TgZ(0,"tr",20)(1,"th",21),e._uU(2),e.qZA(),e.TgZ(3,"th",21),e._uU(4),e.qZA(),e.TgZ(5,"th",21),e._uU(6),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.qZA(),e.TgZ(9,"th"),e._uU(10),e.qZA(),e.TgZ(11,"th"),e._uU(12),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.qZA(),e.TgZ(15,"th"),e._uU(16),e.qZA(),e.TgZ(17,"th"),e._uU(18),e.qZA(),e.TgZ(19,"th",22),e._uU(20),e.qZA()()),2&a){const t=l.$implicit;e.xp6(2),e.Oqu(t.createdBy),e.xp6(2),e.Oqu(t.sarNumber),e.xp6(2),e.Oqu(t.costumerName),e.xp6(2),e.Oqu(t.date),e.xp6(2),e.hij("",t.payPercentaje,"%"),e.xp6(2),e.Oqu(t.discount),e.xp6(2),e.Oqu(t.payCredit),e.xp6(2),e.Oqu(t.payOthers),e.xp6(2),e.Oqu(t.payCash),e.xp6(2),e.Oqu(t.total)}}function I(a,l){if(1&a&&(e.TgZ(0,"tr",20)(1,"th"),e._uU(2),e.qZA(),e.TgZ(3,"th"),e._uU(4),e.qZA(),e.TgZ(5,"th"),e._uU(6),e.qZA()()),2&a){const t=l.$implicit;e.xp6(2),e.Oqu(t.payName),e.xp6(2),e.Oqu(t.payType),e.xp6(2),e.Oqu(t.total)}}let O=(()=>{class a{constructor(t,o,n,r){this.router=t,this.productService=o,this.messageService=n,this.eventService=r,this.loading=!1,this.InvoiceList=[],this.payReport=[],this.redirect=!1,this.AccessName="/pages/freportes"}ngOnInit(){const o=this.eventService.getPermisionsException().split(",").map(n=>n.trim());this.redirect=o.includes(this.AccessName),this.redirect&&this.router.navigateByUrl("/pages/unautorized"),this.userSelected="",this.wareHouseSelectd="",this.GetUsersByRole(),this.GetWareHouseByRole()}load(){this.loading=!0;var t=new F.c;t.initialDate=this.StartDate,t.finalDate=this.FinalDate,this.getInvoiceReport(t)}getInvoiceReport(t){const o=this.eventService.getToken();t.userFilter=null==this.userSelected||"0"==this.userSelected?"ALL":this.userSelected,t.warehouseFilter=null==this.wareHouseSelectd||"0"==this.wareHouseSelectd?"ALL":this.wareHouseSelectd,this.productService.GetInvoiceReport(t,o).subscribe(n=>{var r;if(console.log(n),n.data){this.InvoiceList=n.data.invoices,this.payReport=n.data.pays;var u=0,d=0,m=0,s=0,c=0;null===(r=this.InvoiceList)||void 0===r||r.forEach(h=>{u+=h.payOthers,d+=h.payCash,m+=h.payCredit,s+=h.total,c+=h.discount}),this.totalOthers=u,this.totalCash=d,this.totalCredit=m,this.totalInvoice=s,this.totalDiscount=c}else this.messageService.add({severity:"error",summary:"Error",detail:n.message,life:3e3});this.loading=!1},n=>{this.messageService.add({severity:"error",summary:"Error",detail:n.message,life:3e3}),this.loading=!1})}exportToExcel(){const o=[["Usuario","Fecha","N\xfamero SAR","Nombre del cliente","Descuentos","Pago en efectivo","Pago con cr\xe9dito","Otros pagos","Impuesto total","Total"]];this.InvoiceList.forEach(s=>{o.push([s.createdBy,s.date,s.sarNumber,s.costumerName,s.discount,s.payCash,s.payCredit,s.payOthers,s.totalTax,s.total])});const n=p.P6.aoa_to_sheet(o),r=p.P6.book_new();p.P6.book_append_sheet(r,n,"Detalle de Facturas");const d=[["Nombre de Pago","Tipo de Pago","Total"]];this.payReport.forEach(s=>{d.push([s.payName,s.payType,s.total])});const m=p.P6.aoa_to_sheet(d);p.P6.book_append_sheet(r,m,"Detalle de Pagos"),p.NC(r,"Facturas.xlsx")}filterUser(t){this.userSelected=""==t||null==t?"-1":t}GetUsersByRole(){this.isLoading=!0,this.productService.GetUsersByRoleValues(this.eventService.getToken()).subscribe(t=>{t.data&&(this.usersDropDown=t.data,console.log(this.usersDropDown))})}filterWareHouse(t){this.wareHouseSelectd=t,console.log(this.wareHouseSelectd)}GetWareHouseByRole(){this.productService.GetWareHouseByRoleValues(this.eventService.getToken()).subscribe(t=>{t.data&&(this.wareHouseDropDown=t.data),this.isLoading=!1})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(f.F0),e.Y36(y.M),e.Y36(_.ez),e.Y36(x.P))},a.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],features:[e._Bn([_.ez])],decls:77,vars:16,consts:[["id","print-section"],[1,"grid"],[1,"col-12"],[1,"card"],[2,"display","flex","flex-wrap","wrap","justify-content","space-between"],[2,"flex","1","margin","5px"],["htmlFor","age1"],["inputId","icon",3,"ngModel","showIcon","ngModelChange"],["style","width: 100%;","style","flex: 1; margin: 5px;",4,"ngIf"],["style","flex: 1; margin: 5px;",4,"ngIf"],["label","Search","icon","pi pi-search","iconPos","right",1,"space",2,"width","100%",3,"loading","onClick"],["id","PrintFull"],[4,"ngIf"],[2,"background-color","#7288a2","color","white"],["style","font-size: small;",4,"ngFor","ngForOf"],[2,"color","black"],["printSectionId","PrintFull","ngxPrint","","pButton","","pRipple","","label","imprimir","icon","pi pi-print",1,"p-button-help"],["pButton","","pRipple","","label","Exportar a Excel","icon","pi pi-cloud-download",1,"p-button-success","mr-2",2,"margin-left","10px",3,"disabled","click"],[3,"IsCreating","showFilter","DropDownDataSource","ValueSelectedChange"],[2,"width","100%",3,"IsCreating","showFilter","DropDownDataSource","ValueSelectedChange"],[2,"font-size","small"],["align","left"],["align","right"]],template:function(t,o){if(1&t&&(e._UZ(0,"p-toast"),e.TgZ(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"h4"),e._uU(6,"Reporte de Facturas"),e.qZA(),e.TgZ(7,"div",4)(8,"div",5)(9,"label",6),e._uU(10,"Inicial"),e.qZA(),e.TgZ(11,"p-calendar",7),e.NdJ("ngModelChange",function(r){return o.StartDate=r}),e.qZA()(),e.TgZ(12,"div",5)(13,"label",6),e._uU(14,"Final"),e.qZA(),e.TgZ(15,"p-calendar",7),e.NdJ("ngModelChange",function(r){return o.FinalDate=r}),e.qZA()(),e.YNc(16,q,4,3,"div",8),e.YNc(17,w,4,3,"div",9),e.TgZ(18,"div",5)(19,"p-button",10),e.NdJ("onClick",function(){return o.load()}),e.qZA()()(),e._UZ(20,"p")(21,"p"),e.TgZ(22,"div",11),e.YNc(23,R,4,6,"div",12),e.TgZ(24,"table")(25,"tr",13)(26,"th"),e._uU(27,"Usuario"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Fac. N."),e.qZA(),e.TgZ(30,"th"),e._uU(31,"Cliente"),e.qZA(),e.TgZ(32,"th"),e._uU(33,"Fecha"),e.qZA(),e.TgZ(34,"th"),e._uU(35,"% Pagado"),e.qZA(),e.TgZ(36,"th"),e._uU(37,"Descuento"),e.qZA(),e.TgZ(38,"th"),e._uU(39,"Credito"),e.qZA(),e.TgZ(40,"th"),e._uU(41,"Otros"),e.qZA(),e.TgZ(42,"th"),e._uU(43,"Efectivo"),e.qZA(),e.TgZ(44,"th"),e._uU(45,"Total"),e.qZA()(),e.YNc(46,S,21,10,"tr",14),e.TgZ(47,"tr",15),e._UZ(48,"th"),e.TgZ(49,"th"),e._uU(50,"Totales"),e.qZA(),e._UZ(51,"th")(52,"th")(53,"th"),e.TgZ(54,"th"),e._uU(55),e.qZA(),e.TgZ(56,"th"),e._uU(57),e.qZA(),e.TgZ(58,"th"),e._uU(59),e.qZA(),e.TgZ(60,"th"),e._uU(61),e.qZA(),e.TgZ(62,"th"),e._uU(63),e.qZA()()(),e.TgZ(64,"h5"),e._uU(65,"Detalle de Tipos de Pago sin contar cr\xe9ditos"),e.qZA(),e.TgZ(66,"table")(67,"tr",13)(68,"th"),e._uU(69,"Nombre"),e.qZA(),e.TgZ(70,"th"),e._uU(71,"Tipo"),e.qZA(),e.TgZ(72,"th"),e._uU(73,"Total"),e.qZA()(),e.YNc(74,I,7,3,"tr",14),e.qZA()()()()()(),e._UZ(75,"button",16),e.TgZ(76,"button",17),e.NdJ("click",function(){return o.exportToExcel()}),e.qZA()),2&t){let n,r,u;e.xp6(11),e.Q6J("ngModel",o.StartDate)("showIcon",!0),e.xp6(4),e.Q6J("ngModel",o.FinalDate)("showIcon",!0),e.xp6(1),e.Q6J("ngIf",!o.isLoading&&(null!==(n=null==o.usersDropDown?null:o.usersDropDown.length)&&void 0!==n?n:0)>0),e.xp6(1),e.Q6J("ngIf",!o.isLoading&&(null!==(r=null==o.wareHouseDropDown?null:o.wareHouseDropDown.length)&&void 0!==r?r:0)>0),e.xp6(2),e.Q6J("loading",o.loading),e.xp6(4),e.Q6J("ngIf",(null!==(u=null==o.InvoiceList?null:o.InvoiceList.length)&&void 0!==u?u:0)>0),e.xp6(23),e.Q6J("ngForOf",o.InvoiceList),e.xp6(9),e.Oqu(o.totalDiscount),e.xp6(2),e.Oqu(o.totalCredit),e.xp6(2),e.Oqu(o.totalOthers),e.xp6(2),e.Oqu(o.totalCash),e.xp6(2),e.Oqu(o.totalInvoice),e.xp6(11),e.Q6J("ngForOf",o.payReport),e.xp6(2),e.Q6J("disabled",!o.InvoiceList||0===o.InvoiceList.length)}},dependencies:[g.sg,g.O5,A.f,v.Hq,v.zx,Z.JJ,Z.On,U.I,C.FN,D.t,g.uU],styles:["table[_ngcontent-%COMP%] {\n      border-collapse: collapse;\n      width: 100%;\n    }\n    \n    tr[_ngcontent-%COMP%] {\n      border-bottom: 1px solid #ddd;\n    }\n    .space[_ngcontent-%COMP%] {\n  width: 4px;\n  height: auto;\n  margin-left: 20px;\n}"]}),a})(),b=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[f.Bz.forChild([{path:"",component:O}]),f.Bz]}),a})();var N=i(4036),J=i(4891);let P=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[g.ez,b,A._8,v.hJ,Z.u5,Z.UX,U.K,C.EV,N.kW,J.E]}),a})()}}]);