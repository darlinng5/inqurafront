"use strict";(self.webpackChunksakai=self.webpackChunksakai||[]).push([[7603],{7603:(ie,v,a)=>{a.r(v),a.d(v,{SalesDinamicReportModule:()=>K});var p=a(6895),C=a(9197),S=a(5861),L=a(6166),F=a(4159),J=a.n(F);class N{constructor(s,t,o,r,i){this.initialDate=s,this.finalDate=t,this.selectedUser=o,this.selectedBranch=r,this.userId=i}}var _=a(805),e=a(4650),b=a(7747),x=a(5384),l=a(4006),A=a(5593),O=a(7116);function B(n,s){1&n&&(e.TgZ(0,"div"),e._UZ(1,"app-progress-bar"),e.qZA())}function w(n,s){if(1&n&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.viewValue)}}function I(n,s){if(1&n&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.viewValue)}}let H=(()=>{class n{constructor(t,o){this.producService=t,this.eventService=o,this.searchCriteria=new e.vpe,this.users=[],this.branches=[],this.initialDate="",this.finalDate="",this.selectedUser=null,this.selectedBranch=null}ngOnInit(){this.GetUsersByRole(),this.GetWareHouseByRole()}GetUsersByRole(){this.isLoading=!0,this.producService.GetUsersByRoleValues(this.eventService.getToken()).subscribe(t=>{t.data&&(this.users=t.data)})}GetWareHouseByRole(){this.producService.GetWareHouseByRoleValues(this.eventService.getToken()).subscribe(t=>{t.data&&(this.branches=t.data),this.isLoading=!1})}search(){this.searchCriteria.emit({initialDate:this.initialDate,finalDate:this.finalDate,selectedUser:this.selectedUser,selectedBranch:this.selectedBranch})}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(b.M),e.Y36(x.P))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-header-report-filter"]],outputs:{searchCriteria:"searchCriteria"},decls:23,vars:7,consts:[[4,"ngIf"],[1,"filter-container"],[1,"filter-item"],["for","initial"],["type","datetime-local","id","initial",3,"ngModel","ngModelChange"],["for","final"],["type","datetime-local","id","final",3,"ngModel","ngModelChange"],["for","users"],["id","users",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","branches"],["id","branches",3,"ngModel","ngModelChange"],[1,"search-button",3,"click"],[1,"search-icon"],[3,"value"]],template:function(o,r){1&o&&(e.YNc(0,B,2,0,"div",0),e.TgZ(1,"div",1)(2,"div",2)(3,"label",3),e._uU(4,"Inicial:"),e.qZA(),e.TgZ(5,"input",4),e.NdJ("ngModelChange",function(c){return r.initialDate=c}),e.qZA()(),e.TgZ(6,"div",2)(7,"label",5),e._uU(8,"Final:"),e.qZA(),e.TgZ(9,"input",6),e.NdJ("ngModelChange",function(c){return r.finalDate=c}),e.qZA()(),e.TgZ(10,"div",2)(11,"label",7),e._uU(12,"Usuarios:"),e.qZA(),e.TgZ(13,"select",8),e.NdJ("ngModelChange",function(c){return r.selectedUser=c}),e.YNc(14,w,2,2,"option",9),e.qZA()(),e.TgZ(15,"div",2)(16,"label",10),e._uU(17,"Sucursales:"),e.qZA(),e.TgZ(18,"select",11),e.NdJ("ngModelChange",function(c){return r.selectedBranch=c}),e.YNc(19,I,2,2,"option",9),e.qZA()(),e.TgZ(20,"button",12),e.NdJ("click",function(){return r.search()}),e._UZ(21,"i",13),e._uU(22," Buscar "),e.qZA()()),2&o&&(e.Q6J("ngIf",r.isLoading),e.xp6(5),e.Q6J("ngModel",r.initialDate),e.xp6(4),e.Q6J("ngModel",r.finalDate),e.xp6(4),e.Q6J("ngModel",r.selectedUser),e.xp6(1),e.Q6J("ngForOf",r.users),e.xp6(4),e.Q6J("ngModel",r.selectedBranch),e.xp6(1),e.Q6J("ngForOf",r.branches))},dependencies:[l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.On,p.sg,p.O5,O.R],styles:['[_nghost-%COMP%]{--primary-color: #023b78;--secondary-color: #1565bb;--background-color: #f0f8ff;--text-color: #333;--border-color: #ccc;--hover-color: #e9ecef}.filter-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;gap:1rem;padding:1rem;background-color:var(--background-color);color:var(--text-color)}.filter-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:0;flex:1 1 200px}.filter-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-right:.5rem;font-size:.875rem;font-weight:500}.filter-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filter-item[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border:1px solid var(--border-color);border-radius:4px;padding:.25rem .5rem;font-size:.875rem;width:100%;box-sizing:border-box}.filter-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .filter-item[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--secondary-color)}.search-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:.5rem 1rem;background-color:var(--primary-color);color:#fff;border:none;border-radius:4px;cursor:pointer;transition:background-color .2s;min-width:120px;height:100%;box-sizing:border-box}.search-button[_ngcontent-%COMP%]:hover{background-color:var(--secondary-color)}.search-icon[_ngcontent-%COMP%]{display:inline-block;width:18px;height:18px;background-image:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>\');background-size:contain;margin-right:.5rem}@media (max-width: 768px){.filter-container[_ngcontent-%COMP%]{flex-direction:column}.search-button[_ngcontent-%COMP%]{width:100%;margin-top:1rem}}@media (max-width: 480px){.filter-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .filter-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filter-item[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:.75rem}}']})}return n})();var U=a(5108),M=a(2453);let E=(()=>{class n{transform(t){if(isNaN(t))return"L. 0.00";const o=t.toFixed(2).split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),`L. ${o.join(".")}`}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275pipe=e.Yjl({name:"lempira",type:n,pure:!0})}return n})();function Q(n,s){1&n&&(e.TgZ(0,"div"),e._UZ(1,"app-progress-bar"),e.qZA())}const q=function(n){return{"negative-profit":n}};function z(n,s){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.ALo(7,"lempira"),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.ALo(10,"lempira"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"lempira"),e.qZA(),e.TgZ(14,"td"),e._uU(15),e.ALo(16,"lempira"),e.qZA(),e.TgZ(17,"td",18),e._uU(18),e.ALo(19,"lempira"),e.qZA(),e.TgZ(20,"td"),e._uU(21),e.ALo(22,"lempira"),e.qZA(),e.TgZ(23,"td"),e._uU(24),e.ALo(25,"lempira"),e.qZA(),e.TgZ(26,"td"),e._uU(27),e.ALo(28,"lempira"),e.qZA(),e.TgZ(29,"td"),e._uU(30),e.ALo(31,"lempira"),e.qZA()()),2&n){const t=s.$implicit;e.xp6(2),e.Oqu(t.key),e.xp6(2),e.Oqu(t.count),e.xp6(2),e.Oqu(e.lcZ(7,12,t.totalCost)),e.xp6(3),e.Oqu(e.lcZ(10,14,t.totalTax)),e.xp6(3),e.Oqu(e.lcZ(13,16,t.totalBase)),e.xp6(3),e.Oqu(e.lcZ(16,18,t.totalPrice)),e.xp6(2),e.Q6J("ngClass",e.VKq(30,q,t.totalProfit<0)),e.xp6(1),e.hij(" ",e.lcZ(19,20,t.totalProfit)," "),e.xp6(3),e.Oqu(e.lcZ(22,22,t.totalEfectivo)),e.xp6(3),e.Oqu(e.lcZ(25,24,t.totalCredito)),e.xp6(3),e.Oqu(e.lcZ(28,26,t.totalTransferencia)),e.xp6(3),e.Oqu(e.lcZ(31,28,t.grandTotal))}}function Y(n,s){if(1&n&&(e.TgZ(0,"table")(1,"thead")(2,"tr")(3,"th"),e._uU(4),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Transacciones"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Costo"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Impuesto"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Venta Base"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Venta Total"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Ganancia"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Efectivo"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Cr\xe9dito"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Transferencia"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Total Dinero"),e.qZA()()(),e.TgZ(25,"tbody"),e.YNc(26,z,32,32,"tr",17),e.qZA(),e.TgZ(27,"tfoot")(28,"tr")(29,"td")(30,"strong"),e._uU(31,"Total"),e.qZA()(),e.TgZ(32,"td"),e._uU(33),e.qZA(),e.TgZ(34,"td"),e._uU(35),e.ALo(36,"lempira"),e.qZA(),e.TgZ(37,"td"),e._uU(38),e.ALo(39,"lempira"),e.qZA(),e.TgZ(40,"td"),e._uU(41),e.ALo(42,"lempira"),e.qZA(),e.TgZ(43,"td"),e._uU(44),e.ALo(45,"lempira"),e.qZA(),e.TgZ(46,"td",18),e._uU(47),e.ALo(48,"lempira"),e.qZA(),e.TgZ(49,"td"),e._uU(50),e.ALo(51,"lempira"),e.qZA(),e.TgZ(52,"td"),e._uU(53),e.ALo(54,"lempira"),e.qZA(),e.TgZ(55,"td"),e._uU(56),e.ALo(57,"lempira"),e.qZA(),e.TgZ(58,"td"),e._uU(59),e.ALo(60,"lempira"),e.qZA()()()()),2&n){const t=e.oxw();e.xp6(4),e.Oqu(t.getFieldLabel(t.selectedField)),e.xp6(22),e.Q6J("ngForOf",t.report),e.xp6(7),e.Oqu(t.getTotalCount()),e.xp6(2),e.Oqu(e.lcZ(36,13,t.getTotalCost())),e.xp6(3),e.Oqu(e.lcZ(39,15,t.getTotalTax())),e.xp6(3),e.Oqu(e.lcZ(42,17,t.getTotalPrecioBase())),e.xp6(3),e.Oqu(e.lcZ(45,19,t.getTotalPrice())),e.xp6(2),e.Q6J("ngClass",e.VKq(31,q,t.getTotalProfit()<0)),e.xp6(1),e.hij(" ",e.lcZ(48,21,t.getTotalProfit())," "),e.xp6(3),e.Oqu(e.lcZ(51,23,t.getTotalEfectivo())),e.xp6(3),e.Oqu(e.lcZ(54,25,t.getTotalCredito())),e.xp6(3),e.Oqu(e.lcZ(57,27,t.getTotalTransferencia())),e.xp6(3),e.Oqu(e.lcZ(60,29,t.getGrandTotal()))}}function j(n,s){1&n&&(e.TgZ(0,"div"),e._UZ(1,"app-progress-bar"),e.qZA())}let k=(()=>{class n{constructor(t,o,r){this.productService=t,this.eventService=o,this.messageService=r,this.startDate=(new Date).toISOString().slice(0,10),this.endDate=(new Date).toISOString().slice(0,10),this.selectedField="customer",this.isLoading=!1,this.salesData=[],this.report=[]}ngOnInit(){this.messageService.add({severity:"info",summary:"Info",detail:"Inqura le recomienda dar clic en el icono de Expasion para una mejor visualizacion de datos",life:3e3})}GetReport(t){this.resultMessage="",this.isLoading=!0,this.productService.GetDynamicSalesReport(t).subscribe(o=>{o.data?(this.salesData=o.data||[],this.resultMessage=o.message,this.generateReport()):this.messageService.add({severity:"error",summary:"Error",detail:o.message,life:3e3}),this.isLoading=!1})}generateReport(){const t=this.groupBy(this.salesData,this.selectedField);this.report=Object.keys(t).map(o=>({key:o,count:t[o].length,totalCost:t[o].reduce((r,i)=>r+i.costPrice,0),totalPrice:t[o].reduce((r,i)=>r+i.price,0),totalBase:t[o].reduce((r,i)=>r+i.price-i.tax,0),totalProfit:t[o].reduce((r,i)=>r+i.price-i.tax-i.costPrice,0),totalTax:t[o].reduce((r,i)=>r+i.tax,0),totalEfectivo:t[o].reduce((r,i)=>r+i.efectivo,0),totalCredito:t[o].reduce((r,i)=>r+i.credito,0),totalTransferencia:t[o].reduce((r,i)=>r+i.transferencia,0),grandTotal:t[o].reduce((r,i)=>r+i.efectivo+i.transferencia+i.credito,0)}))}groupBy(t,o){return t.reduce((r,i)=>((r[i[o]]=r[i[o]]||[]).push(i),r),{})}getFieldLabel(t){return{customer:"Cliente",invoice:"N\xfamero de Factura",productName:"Nombre del Producto",comercialName:"Sucursal",taxName:"Impuesto"}[t]||t}getTotalCount(){return this.report.reduce((t,o)=>t+o.count,0)}getTotalCost(){return this.report.reduce((t,o)=>t+o.totalCost,0)}getTotalPrice(){return this.report.reduce((t,o)=>t+o.totalPrice,0)}getTotalTax(){return this.report.reduce((t,o)=>t+o.totalTax,0)}getTotalEfectivo(){return this.report.reduce((t,o)=>t+o.totalEfectivo,0)}getTotalCredito(){return this.report.reduce((t,o)=>t+o.totalCredito,0)}getTotalTransferencia(){return this.report.reduce((t,o)=>t+o.totalTransferencia,0)}getTotalPrecioBase(){return this.report.reduce((t,o)=>t+o.totalPrice-o.totalTax,0)}getGrandTotal(){return this.report.reduce((t,o)=>t+o.grandTotal,0)}getTotalProfit(){return this.report.reduce((t,o)=>t+o.totalProfit,0)}printReport(){var t=this;return(0,S.Z)(function*(){t.isLoading=!0;const o=document.getElementById("print-section"),r=new L.ZP("p","pt","a4"),i={background:"white",scale:3},c=r.internal.pageSize.getWidth(),$=r.internal.pageSize.getHeight(),g={top:15,bottom:15,left:15,right:15},P=c-g.left-g.right,Z=$-g.top-g.bottom;function X(d,R,u){R.addImage(d,"PNG",g.left,u,P,0,void 0,"FAST")}try{const d=yield J()(o,i),u=(d.toDataURL("image/png"),d.width),h=u/P;let m=d.height/h,y=g.top,D=1;for(;m>0;){const T=Math.min(Z,m),f=document.createElement("canvas"),re=f.getContext("2d");f.width=u,f.height=T*h,re.drawImage(d,0,(D-1)*Z*h,u,T*h,0,0,u,T*h),X(f.toDataURL("image/png"),r,y),m-=Z,y=g.top,m>0&&(r.addPage(),D++)}const te=r.output("blob"),oe=URL.createObjectURL(te);t.isLoading=!1,window.open(oe,"_blank")}catch(d){console.error("Error generando PDF:",d),t.isLoading=!1}})()}handleSearchCriteria(t){var o=new N(t.initialDate,t.finalDate,t.selectedUser,t.selectedBranch,this.eventService.getToken());this.GetReport(o)}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(b.M),e.Y36(x.P),e.Y36(_.ez))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-dinamic-report"]],features:[e._Bn([_.ez])],decls:35,vars:5,consts:[[1,"invoice-report"],[4,"ngIf"],[3,"searchCriteria"],["id","print-section"],[1,"report-options"],[2,"text-align","center"],[3,"ngModel","ngModelChange","change"],["value","customer"],["value","userName"],["value","comercialName"],["value","invoice"],["value","productName"],["value","taxName"],["value","terms"],["value","isActualSale"],["align","right"],["pButton","","label","Imprimir","icon","pi pi-print",1,"p-button-outlined","mb-2",3,"click"],[4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(o,r){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Q,2,0,"div",1),e._UZ(2,"p-toast"),e.TgZ(3,"app-header-report-filter",2),e.NdJ("searchCriteria",function(c){return r.handleSearchCriteria(c)}),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"h2"),e._uU(8,"Reporte de Ventas"),e.qZA()(),e.TgZ(9,"div",5)(10,"h5"),e._uU(11),e.qZA()(),e.TgZ(12,"label"),e._uU(13," Agrupar por: "),e.TgZ(14,"select",6),e.NdJ("ngModelChange",function(c){return r.selectedField=c})("change",function(){return r.generateReport()}),e.TgZ(15,"option",7),e._uU(16,"Cliente"),e.qZA(),e.TgZ(17,"option",8),e._uU(18,"Usuario"),e.qZA(),e.TgZ(19,"option",9),e._uU(20,"Sucursal"),e.qZA(),e.TgZ(21,"option",10),e._uU(22,"N\xfamero de Factura"),e.qZA(),e.TgZ(23,"option",11),e._uU(24,"Nombre del Producto"),e.qZA(),e.TgZ(25,"option",12),e._uU(26,"Tipo de Impuesto"),e.qZA(),e.TgZ(27,"option",13),e._uU(28,"Terminos de Pago"),e.qZA(),e.TgZ(29,"option",14),e._uU(30,"Cobro de facturas del Periodo / Cobro de facturas fuera del periodo"),e.qZA()()()(),e.YNc(31,Y,61,33,"table",1),e.qZA()(),e.YNc(32,j,2,0,"div",1),e.TgZ(33,"p-divider",15)(34,"button",16),e.NdJ("click",function(){return r.printReport()}),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("ngIf",r.isLoading),e.xp6(10),e.hij(" ",r.resultMessage," "),e.xp6(3),e.Q6J("ngModel",r.selectedField),e.xp6(17),e.Q6J("ngIf",r.report.length>0),e.xp6(1),e.Q6J("ngIf",r.isLoading))},dependencies:[p.mk,p.sg,p.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,A.Hq,O.R,H,U.i,M.FN,E],styles:["[_nghost-%COMP%]{--primary-color: #023b78;--secondary-color: #1565bb;--background-color: #f0f8ff;--text-color: #333;--border-color: #ccc;--hover-color: #e9ecef;display:block;font-family:Arial,sans-serif;color:var(--text-color);background-color:var(--background-color);padding:20px;border-radius:8px;box-shadow:0 4px 6px #0000001a}h2[_ngcontent-%COMP%]{color:var(--primary-color);margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:15px;font-weight:700}select[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px;background-color:#fff;font-size:16px;margin-top:5px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px;background-color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid var(--border-color)}th[_ngcontent-%COMP%]{background-color:var(--secondary-color);color:#fff;font-weight:700}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--hover-color)}tfoot[_ngcontent-%COMP%]{font-weight:700}tfoot[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:2px solid var(--primary-color)}.negative-profit[_ngcontent-%COMP%]{color:red}"]})}return n})(),G=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[C.Bz.forChild([{path:"",component:k}]),C.Bz]})}return n})();var V=a(9585),W=a(4891);let K=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[p.ez,G,l.u5,A.hJ,V.xD,l.u5,W.E,U.x,M.EV]})}return n})()}}]);